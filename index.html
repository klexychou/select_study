<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ç§‘å­¸ç­è®€æ›¸è¨ˆç•« V7.3</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#121212">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100' style='background-color: %232c3e50'%3E%3Crect width='100' height='100' fill='%232c3e50'/%3E%3Ctext y='50%25' x='50%25' dominant-baseline='central' text-anchor='middle' font-size='60' %3EğŸ“š%3C/text%3E%3C/svg%3E">

    <style>
        /* --- å…¨å±€è®Šæ•¸ --- */
        :root {
            --list-font-size: 16px;
        }

        /* --- å…¨å±€è¨­å®š --- */
        body {
            font-family: "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #121212;
            color: #ffffff;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            user-select: none;
        }

        .hidden { display: none !important; }

        button {
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }
        button:active { transform: scale(0.92); }

        /* --- å½©å¸¶ Canvas --- */
        #confetti-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999;
        }

        /* --- Header --- */
        .header-nav {
            flex-shrink: 0;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #1e1e1e;
            border-bottom: 1px solid #333;
            min-height: 45px;
            z-index: 10;
        }
        h2 { margin: 0; color: #3498db; font-size: 18px; }
        .icon-btn {
            background: #333; color: #ddd; font-size: 14px; padding: 6px 10px; border-radius: 8px; margin-left: 8px;
        }
        .icon-btn.active { background: #3498db; color: white; }

        /* --- è¨­å®šé é¢ --- */
        #setup-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .controls-wrapper {
            flex-shrink: 0;
            padding: 8px 15px;
            background: #121212;
        }

        .control-bar {
            background-color: #252525;
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid #333;
            /* margin-bottom: 5px;  ç¾åœ¨åªæœ‰ä¸€è¡Œï¼Œä¸éœ€è¦åº•éƒ¨ margin */
        }
        
        /* ç”±æ–¼åªå‰©ä¸€è¡Œï¼Œç°¡åŒ–çµæ§‹ */
        .control-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .switch-container { position: relative; display: inline-block; width: 40px; height: 24px; }
        .switch-container input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #e67e22; }
        input:checked + .slider:before { transform: translateX(16px); }

        /* --- åˆ—è¡¨å€åŸŸ --- */
        .list-container {
            flex: 1;
            overflow-y: auto;
            padding: 0 15px;
            min-height: 0;
        }
        
        .subject-row {
            display: flex;
            align-items: center;
            background-color: #1e1e1e;
            margin-bottom: 4px;
            padding: 4px 10px;
            border-radius: 8px;
            border: 1px solid #333;
            width: 100%;
            box-sizing: border-box; 
        }

        input[type="checkbox"].sub-check {
            flex-shrink: 0;
            transform: scale(1.1);
            margin-right: 8px;
            accent-color: #3498db;
        }
        
        .name-input {
            flex: 1;
            width: 0;
            min-width: 50px;
            font-size: var(--list-font-size); /* å‹•æ…‹å­—é«” */
            font-weight: 500;
            background: transparent;
            border: none;
            color: white;
            border-bottom: 1px solid transparent;
            padding: 2px 0;
            margin-right: 6px;
            border-radius: 0;
        }
        .name-input:focus { border-bottom: 1px solid #3498db; outline: none; background: #252525; }

        .weight-input {
            flex-shrink: 0;
            width: 32px; height: 26px; text-align: center; font-size: 14px;
            background-color: #2c3e50; color: #fff; border: 1px solid #444; border-radius: 5px; margin-right: 6px;
        }

        .order-btn-group {
            flex-shrink: 0; display: flex; flex-direction: column; gap: 1px; width: 22px;
        }
        .order-btn {
            background: #333; color: #aaa; border-radius: 3px; padding: 0; font-size: 8px; height: 12px; line-height: 12px; width: 100%;
        }
        .order-btn:active { background: #555; color: white; }

        /* --- åº•éƒ¨æŒ‰éˆ•å€ (Flexbox ä¿®æ”¹) --- */
        .bottom-action-area {
            flex-shrink: 0;
            padding: 10px 15px 15px 15px;
            background: #121212;
            display: flex;  /* æ”¹ç‚º Flexbox */
            gap: 10px;      /* æŒ‰éˆ•é–“è· */
            align-items: stretch; /* è®“æŒ‰éˆ•é«˜åº¦ä¸€è‡´ */
        }

        /* å­—é«”èª¿æ•´æŒ‰éˆ• */
        .font-btn {
            flex-shrink: 0;
            width: 50px; /* å›ºå®šå¯¬åº¦ */
            background-color: #252525;
            color: #ccc;
            border: 1px solid #333;
            font-family: serif; /* è¥¯ç·šå­—é«”è®“ A æ›´æœ‰å‹ */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .font-btn:active { background-color: #333; }

        .start-btn {
            flex: 1; /* è‡ªå‹•ä½”æ“šå‰©é¤˜å¯¬åº¦ */
            padding: 14px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white; font-size: 18px; border-radius: 12px;
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.4);
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ›è¡Œ */
        }

        /* --- æŠ½ç±¤é é¢ --- */
        #draw-screen { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; z-index: 10;}
        #deck-status { position: absolute; top: 30px; right: 20px; background: #e67e22; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: bold; color: white; }
        #result-display { font-size: 64px; font-weight: 800; color: #e74c3c; margin-bottom: 10px; text-align: center; padding: 0 20px; line-height: 1.2; text-shadow: 0 0 20px rgba(231, 76, 60, 0.5); }
        #prob-display { color: #7f8c8d; font-size: 16px; margin-bottom: 60px; }
        .action-btn { padding: 20px 80px; font-size: 24px; background: linear-gradient(135deg, #3498db, #2980b9); color: white; border-radius: 50px; margin-bottom: 20px; box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4); }
        .action-btn:disabled { background: #555; color: #888; box-shadow: none; }
        .back-btn { background: transparent; color: #7f8c8d; font-size: 14px; padding: 10px 20px; }

        /* --- ç†±åŠ›åœ– (Heatmap) --- */
        #stats-screen { flex: 1; display: flex; flex-direction: column; background: #121212; z-index: 10;}
        .heatmap-container { flex: 1; padding: 20px; overflow-y: auto; }
        .heatmap-grid { display: grid; grid-template-columns: auto repeat(7, 1fr); gap: 4px; align-items: center; }
        .hm-cell { width: 100%; aspect-ratio: 1; border-radius: 4px; background-color: #1e1e1e; }
        .hm-label-col { font-size: 12px; color: #ccc; text-align: right; padding-right: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }
        .lvl-0 { background-color: #252525; }
        .lvl-1 { background-color: #0e4429; }
        .lvl-2 { background-color: #006d32; }
